#!/bin/bash

sudo apt-get install sqlite
sudo apt-get install libsqlite3-dev
sudo easy_install pep8

SCRIPT_DIR="$( cd "$( dirname "$0" )" && pwd )"
DOWN_DIR="$HOME/Downloads"

# TODO: Conditional download function
# TODO: Put all file version string at top of this file

# Install OpenSSL
read -p "Install Open SSL (y/n): "
if [ "$REPLY" = "y" ]; then
    cd $HOME/Downloads
    wget http://www.openssl.org/source/openssl-0.9.8g.tar.gz

    cs $HOME/src
    tar -xzvf $HOME/Downloads/openssl-0.9.8g.tar.gz

    cd openssl-0.9.8g.tar.gz
    ./config
    make
    sudo make install
fi

# Get Python 2.5.2
read -p "Install Python 2.5.2 (y/n): "
if [ "$REPLY" = "y" ]; then
    cd $HOME/Downloads
    if [ ! -f Python-2.5.2.tgz ]; then
        wget http://www.python.org/ftp/python/2.5.2/Python-2.5.2.tgz
        cd $HOME/src
        tar -xzvf $HOME/Downloads/Python-2.5.2.tgz
    fi

    cd $HOME/src/Python-2.5.2
    ./configure
    make clean
    make
    sudo make altinstall
fi

# TODO: Install setup tools
# http://pypi.python.org/packages/2.5/s/setuptools/setuptools-0.6c11-py2.5.egg#md5=64c94f3bf7a72a13ec83e0b24f2749b2
# sh setuptools-0.6c11-py2.5

sudo easy_install-2.5 mock
sudo easy_install-2.5 PIL

# Get SSL Library not supported in native 2.5.2
read -p "Install Python ssl Library (y/n): "
if [ "$REPLY" = "y" ]; then
    cd $HOME/Downloads
    if [! -f ssl-1.15.tar.gz ]; then
        wget http://pypi.python.org/packages/source/s/ssl/ssl-1.15.tar.gz
        cd $HOME/src
        tar -xzvf $HOME/Downloads/ssl-1.15.tar.gz
    fi

    cd $HOME/src/ssl-1.15
    sudo python2.5 setup.py install
fi

# Get Django 1.1
read -p "Install Django 1.1 (y/n): "
if [ "$REPLY" = "y" ]; then
    cd $DOWN_DIR
    if [! -f Django-1.1.2.tar.gz ]; then
        wget  http://media.djangoproject.com/releases/1.1/Django-1.1.2.tar.gz
        cd $HOME/src
        tar -xzvf $HOME/Downloads/Django-1.1.2.tar.gz
    fi

    cd $HOME/src/Django-1.1.2
    sudo python2.5 setup.py install
fi

AE_PATH="http://googleappengine.googlecode.com/files"
AE_FILE="google_appengine_1.3.8.zip"
AE_PARENT="/usr/local"
AE_DIR="google_appengine"

# Get AppEngine - needs to be in /usr/local for django helper to find properly?
read -p "Install App Engine (y/n): "
if [ "$REPLY" = "y" ]; then
    cd $DOWN_DIR
    if [ ! -f $AE_FILE ]; then
        wget $AE_PATH/$AE_FILE
    fi

    cd $AE_PARENT
    sudo rm -rf $AE_DIR
    sudo unzip $DOWN_DIR/$AE_FILE
    sudo chmod -R o+rx $AE_DIR

    cd /usr/local/bin

    # Put dev_appserver.py and appcfg.py directly into PATH
    sudo ln -f -s /usr/local/$AE_DIR/dev_appserver.py
    sudo ln -f -s /usr/local/$AE_DIR/appcfg.py
fi

read -p "Install App Engine Helper (y/n): "
if [ "$REPLY" = "y" ]; then
    cd $HOME/Downloads
    if [ ! -f appengine_helper_for_django-r105.zip ]; then
        wget  http://google-app-engine-django.googlecode.com/files/appengine_helper_for_django-r105.zip
    fi

    cd /usr/local
    sudo unzip $HOME/Downloads/appengine_helper_for_django-r105.zip
    sudo chmod -R o+rwx appengine_helper_for_django

    cd appengine_helper_for_django
    patch -p1 -i $SCRIPT_DIR/aeh.patch

    # Remove slow or mis-behaving tests
    cd appengine_django/tests
    rm commands_test.py integration_test.py serialization_test.py

fi
