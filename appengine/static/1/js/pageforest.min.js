/* Begin file: namespace.js */
try{var console=(function(){if(console!=undefined){return console;}
var noop=function(){};var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];var consoleT={};for(var i=0;i<names.length;++i){consoleT[names[i]]=noop;}
return consoleT;}());}
catch(e){}
var namespace=(function(){try{if(namespace!=undefined){return namespace;}}
catch(e){}
function Namespace(parent,name){if(name){name=name.replace(/-/g,'_');}
this._isDefined=false;this._parent=parent;if(this._parent){this._parent[name]=this;this._path=this._parent._path;if(this._path!==''){this._path+='.';}
this._path+=name;}else{this._path='';}}
var namespaceT=new Namespace(null);function extendObject(dest,args){if(dest===undefined){dest={};}
for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var prop in source){if(source.hasOwnProperty(prop)){dest[prop]=source[prop];}}}
return dest;}
function copyArray(arg){return Array.prototype.slice.call(arg,0);}
Function.prototype.methods=function(obj){extendObject(this.prototype,obj);};Function.methods({fnMethod:function(obj){var _fn=this;return function(){return _fn.apply(obj,arguments);};},fnArgs:function(){var _fn=this;var _args=copyArray(arguments);return function(){var args=copyArray(arguments).concat(_args);var self=this;return _fn.apply(self,args);};}});Namespace.methods({define:function(callback){this._isDefined=true;console.info("Namespace '"+this._path+"' defined.");if(callback){callback(this);}
return this;},defineOnce:function(callback){if(this._isDefined){console.warn("WARNING: Namespace '"+this._path+"' redefinition.");return this;}
return this.define(callback);},extend:function(){var args=[this].concat(copyArray(arguments));return extendObject.apply(undefined,args);},nameOf:function(symbol){symbol=symbol.replace(/-/g,'_');return'namespace.'+this._sPath+'.'+symbol;}});extendObject(namespaceT,{lookup:function(path){path=path.replace(/-/g,'_');var parts=path.split('.');var cur=namespaceT;for(var i=0;i<parts.length;i++){var name=parts[i];if(cur[name]===undefined){cur=new Namespace(cur,name);}
else{cur=cur[name];}}
return cur;}});namespaceT.lookup('util').extend({extendObject:extendObject,copyArray:copyArray}).defineOnce();return namespaceT;}());
/* Begin file: misc.js */
namespace.lookup("com.pageforest.misc").define(function(ns){ns.strip=function(s){return(s||"").replace(/^\s+|\s+$/g,"");};});
/* Begin file: random.js */
namespace.lookup("com.pageforest.random").defineOnce(function(ns){ns.upper='ABCDEFGHIJKLMNOPQRSTUVWXYZ';ns.lower='abcdefghijklmnopqrstuvwxyz';ns.digits='0123456789';ns.base64=ns.upper+ns.lower+ns.digits+'+/';ns.base64url=ns.upper+ns.lower+ns.digits+'-_';ns.hexdigits=ns.digits+'abcdef';ns.random=function(len,chars){if(typeof chars=='undefined'){chars=ns.base64url;}
var radix=chars.length;var result=[];for(var i=0;i<len;i++){result[i]=chars[0|Math.random()*radix];}
return result.join('');};});
/* Begin file: cookies.js */
namespace.lookup('com.pageforest.cookies').define(function(ns){var misc=namespace.lookup('com.pageforest.misc');ns.extend({setCookie:function(name,value,days,path){var expires='';if(days){var date=new Date();date.setTime(date.getTime()+days*24*60*60*1000);expires='; expires='+date.toGMTString();}
path='; path='+(path||'/');document.cookie=encodeURIComponent(name)+'='+encodeURIComponent(value)
+expires+path;},getCookie:function(name){return ns.getCookies()[name];},getCookies:function(name){var st=document.cookie;var rgPairs=st.split(";");var obj={};for(var i=0;i<rgPairs.length;i++){rgPairs[i]=misc.strip(rgPairs[i]);var rgC=rgPairs[i].split("=");var val=decodeURIComponent(rgC[1]);var rg=val.match('^"(.*)"$');if(rg)
val=rg[1].replace('\\"','"');obj[decodeURIComponent(rgC[0])]=val;}
return obj;}});});
/* Begin file: registration.js */
namespace.lookup('com.pageforest.registration').define(function(ns){var util=namespace.util;function html_message(name,message){if($("#id_"+name).val()===''){return'';}
if(message){return'<span class="error">'+message+'</span>';}
return'<span class="success">OK</span>';}
function validate_success(message,status,xhr){var fields={"username":"username","email":"email","password":"password","repeat":"__all__"};for(var name in fields){if(fields.hasOwnProperty(name)){$("#validate_"+name).html(html_message(name,message[fields[name]]));}}}
function validate_error(xhr,status,message){console.error(xhr);}
function validate_if_changed(){var data={username:$("#id_username").val(),email:$("#id_email").val(),password:$("#id_password").val(),repeat:$("#id_repeat").val(),tos:$("#id_tos").attr('checked')?'checked':'',validate:true};var oneline=[data.username,data.email,data.password,data.repeat];oneline=oneline.join('~');if(oneline==ns.previous){return;}
ns.previous=oneline;$.ajax({type:"POST",url:"/sign-up",data:data,dataType:"json",success:validate_success,error:validate_error});}
ns.document_ready=function(){ns.previous='~~~';setInterval(validate_if_changed,3000);$("#id_tos").click(function(){$("#validate_tos").html('');});};});
/* Begin file: sign-in-form.js */
namespace.lookup('com.pageforest.auth.sign-in-form').define(function(ns){var cookies=namespace.lookup('com.pageforest.cookies');ns.extend({documentReady:function(username,appId){ns.appId=appId;ns.appAuthURL=ns.getAppDomain(appId)+'/auth/';var sessionName=appId+"-sessionkey";var appSession=cookies.getCookies()[sessionName];console.log("appSession: ",appSession);if(appSession!=undefined){cookies.setCookie(sessionName,'expired',-1);ns.transferSession(appSession);}
if(!username){return;}
if(!appId){ns.closeForm();return;}
ns.getString(ns.appAuthURL+"username/",function(username){if(typeof(username)=='string'){ns.closeForm();return;}});},transferSession:function(sessionKey){ns.getString(ns.appAuthURL+"set-session/"+sessionKey,function(s){if(typeof(s)!='string'){return;}
if(sessionKey)
ns.closeForm();});},getAppDomain:function(appId){var parts=window.location.host.split('.');if(parts[0]=='www')
parts[0]=appId;else
parts.splice(0,0,appId);return parts.join('.');},getString:function(url,fn){url="http://"+url;$.ajax({type:"GET",url:url,dataType:"jsonp",success:fn,error:function(){fn({status:500});}});},closeForm:function(){function closeFinal(){window.close();}
if(ns.appId)
$(".have_app").show();$(".want_app").hide();setTimeout(closeFinal,2000);}});});
