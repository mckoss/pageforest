/* Begin file: namespace.js */
if(!window.console){(function(){var noop=function(){};var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var i=0;i<names.length;++i){window.console[names[i]]=noop;}}());}
(function(){var sGlobal='global_namespace';if(window[sGlobal]){return;}
function Namespace(nsParent,sName){if(sName){sName=sName.replace(/-/g,'_');}
this._nsParent=nsParent;if(this._nsParent){this._nsParent[sName]=this;this._sPath=this._nsParent._sPath;if(this._sPath!==''){this._sPath+='.';}
this._sPath+=sName;}else{this._sPath='';}}
Namespace.prototype.extend=function(oDest,var_args){if(oDest===undefined){oDest={};}
for(var i=1;i<arguments.length;i++){var oSource=arguments[i];for(var prop in oSource){if(oSource.hasOwnProperty(prop)){oDest[prop]=oSource[prop];}}}
return oDest;};var ns=window[sGlobal]=new Namespace(null);ns.extend(Namespace.prototype,{define:function(sPath,fnCallback){sPath=sPath.replace(/-/g,'_');var aPath=sPath.split('.');var nsCur=this;for(var i=0;i<aPath.length;i++){var sName=aPath[i];if(nsCur[sName]===undefined){var nsNew=new Namespace(nsCur,sName);}
nsCur=nsCur[sName];}
if(fnCallback){if(!nsCur._fDefined){nsCur._fDefined=true;fnCallback(nsCur);console.info("Namespace '"+nsCur._sPath+"' defined.");}else{console.warn("WARNING: Namespace '"+nsCur._sPath+"' redefinition.");}}else if(!nsCur._fDefined){console.warn("Namespace '"+nsCur._sPath+"' forward reference.");}
return nsCur;},lookup:function(sPath){return window[sGlobal].define(sPath);},nameOf:function(sInNamespace){sInNamespace=sInNamespace.replace(/-/g,'_');return sGlobal+'.'+this._sPath+'.'+sInNamespace;},isOwn:function(object,name){return Object.prototype.hasOwnProperty.call(object,name);}});}());
/* Begin file: registration.js */
global_namespace.define('com.pageforest.registration',function(ns){function html_message(name,message){if($("#id_"+name).val()===''){return'';}
if(message){return'<span class="error">'+message+'</span>';}
return'<span class="success">OK</span>';}
function validate_success(message,status,xhr){var fields={"username":"username","email":"email","password":"password","repeat":"__all__"};for(var name in fields){if(ns.isOwn(fields,name)){$("#validate_"+name).html(html_message(name,message[fields[name]]));}}}
function validate_error(xhr,status,message){console.error(xhr);}
function validate_if_changed(){var data={username:$("#id_username").val(),email:$("#id_email").val(),password:$("#id_password").val(),repeat:$("#id_repeat").val(),tos:$("#id_tos").attr('checked')?'checked':'',validate:true};var oneline=[data.username,data.email,data.password,data.repeat];oneline=oneline.join('~');if(oneline==ns.previous){return;}
ns.previous=oneline;$.ajax({type:"POST",url:"/sign-up",data:data,dataType:"json",success:validate_success,error:validate_error});}
ns.document_ready=function(){ns.previous='~~~';setInterval(validate_if_changed,3000);$("#id_tos").click(function(){$("#validate_tos").html('');});};});
/* Begin file: sign-in-form.js */
global_namespace.define('com.pageforest.auth.sign-in-form',function(ns){var cookies=ns.lookup('org.startpad.cookies');ns.extend(ns,{documentReady:function(username,appId){ns.appId=appId;ns.appAuthURL=ns.getAppDomain(appId)+'/auth/';if(!username)
return;if(!appId){ns.closeForm();return;}
var sessionName=appId+"-sessionkey";var appSession=cookies.getCookies()[sessionName];if(appSession!=undefined){cookies.setCookie(sessionName,'',0);ns.transferSession(appSession);}
ns.getString(ns.appAuthURL+"username/",function(username){if(typeof(username)=='string'){ns.closeForm();return;}});},transferSession:function(sessionKey){ns.getString(ns.appAuthURL+"set-session/"+sessionKey,function(s){alert(s);if(typeof(s)!='string'){return;}
ns.closeForm();});},getAppDomain:function(appId){var parts=window.location.host.split('.');if(parts[0]=='www')
parts[0]=appId;else
parts.splice(0,0,appId);return parts.join('.');},getString:function(url,fn){url="http://"+url;$.ajax({type:"GET",url:url,dataType:"jsonp",success:fn,error:function(){fn({status:500});}});},closeForm:function(){function closeFinal(){window.close();}
if(ns.appId)
$(".have_app").show();$(".want_app").hide();setTimeout(closeFinal,5000);}});});
/* Begin file: formatutil.js */
global_namespace.define('org.startpad.format-util',function(NS){NS.extend(NS,{Thousands:function(d)
{var s=d.toString();var sLast="";while(s!=sLast)
{sLast=s;s=s.replace(/(\d+)(\d{3})/,"$1,$2");}
return s;},Slugify:function(s)
{s=s.Trim().toLowerCase();s=s.replace(/[^\w\s-]/g,'-').replace(/[-\s]+/g,'-').replace(/(^-+)|(-+$)/g,'');return s;},FormatNumber:function(val,digits)
{var nInt=Math.floor(val);var sInt=nInt.toString();var sLast="";while(sInt!=sLast)
{sLast=sInt;sInt=sInt.replace(/(\d+)(\d{3})/,"$1,$2");}
if(digits&&digits>0)
{var nFrac=val-nInt;nFrac=Math.floor(nFrac*Math.pow(10,digits));sFrac="."+SDigits(nFrac,digits);}
else
sFrac="";return sInt+sFrac;},SDigits:function(val,c,fSign)
{var s="";var fNeg=(val<0);if(c==undefined)
c=0;if(fNeg)
val=-val;val=Math.floor(val);for(;c>0;c--)
{s=(val%10)+s;val=Math.floor(val/10);}
if(fSign||fNeg)
s=(fNeg?"-":"+")+s;return s;},EscapeHTML:function(s)
{s=s.toString();s=s.replace(/&/g,'&amp;');s=s.replace(/</g,'&lt;');s=s.replace(/>/g,'&gt;');s=s.replace(/\"/g,'&quot;');s=s.replace(/'/g,'&#39;');return s;},ReplaceKeys:function(st,keys)
{for(var key in keys)
st=st.StReplace("{"+key+"}",keys[key]);st=st.replace(/\{[^\{\}]*\}/g,"");return st;},strip:function(s)
{return(s||"").replace(/^\s+|\s+$/g,"");}});String.prototype.StReplace=function(stPat,stRep)
{var st="";if(stRep==undefined)
stRep="";else
stRep=stRep.toString();var ich=0;var ichFind=this.indexOf(stPat,0);while(ichFind>=0)
{st+=this.substring(ich,ichFind)+stRep;ich=ichFind+stPat.length;ichFind=this.indexOf(stPat,ich);}
st+=this.substring(ich);return st;};});
/* Begin file: cookies.js */
global_namespace.define('org.startpad.cookies',function(ns){var format=ns.lookup('org.startpad.format-util');ns.extend(ns,{setCookie:function(name,value,days,path){var expires='';if(days){var date=new Date();date.setTime(date.getTime()+days*24*60*60*1000);expires='; expires='+date.toGMTString();}
path='; path='+(path||'/');document.cookie=encodeURIComponent(name)+'='+encodeURIComponent(value)
+expires+path;},getCookie:function(name){return ns.getCookies()[name];},getCookies:function(name){var st=document.cookie;var rgPairs=st.split(";");var obj={};for(var i=0;i<rgPairs.length;i++){rgPairs[i]=format.strip(rgPairs[i]);var rgC=rgPairs[i].split("=");var val=decodeURIComponent(rgC[1]);var rg=val.match('^"(.*)"$');if(rg)
val=rg[1].replace('\\"','"');obj[decodeURIComponent(rgC[0])]=val;}
return obj;}});});
