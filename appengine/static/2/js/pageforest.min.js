/* Begin file: namespace.js */
if(typeof console=='undefined'){var console=(function(){if(console!=undefined){return console;}
var noop=function(){};var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];var consoleT={};for(var i=0;i<names.length;++i){consoleT[names[i]]=noop;}
return consoleT;}());}
var namespace=(function(){try{if(namespace!=undefined){return namespace;}}
catch(e){}
function Namespace(parent,name){if(name){name=name.replace(/-/g,'_');}
this._isDefined=false;this._referenced=[];this._parent=parent;if(this._parent){this._parent[name]=this;this._path=this._parent._path;if(this._path!==''){this._path+='.';}
this._path+=name;}else{this._path='';}}
var namespaceT=new Namespace(null);namespaceT.logLevel=2;var enumBug=!{toString:true}.propertyIsEnumerable('toString');var internalNames=['toString','toLocaleString','valueOf','constructor','isPrototypeOf'];function extendObject(dest,args){var i,j;var source;var prop;if(dest===undefined){dest={};}
for(i=1;i<arguments.length;i++){source=arguments[i];for(prop in source){if(source.hasOwnProperty(prop)){dest[prop]=source[prop];}}
if(!enumBug){continue;}
for(j=0;j<internalNames.length;j++){prop=internalNames[j];if(source.hasOwnProperty(prop)){dest[prop]=source[prop];}}}
return dest;}
function copyArray(arg){return Array.prototype.slice.call(arg,0);}
Function.prototype.methods=function(obj){extendObject(this.prototype,obj);};Function.methods({fnMethod:function(obj){var _fn=this;return function(){return _fn.apply(obj,arguments);};},fnArgs:function(){var _fn=this;var _args=copyArray(arguments);return function(){var args=copyArray(arguments).concat(_args);return _fn.apply(this,args);};},fnWrap:function(fn){var _fn=this;return function(){return _fn(this,fn,arguments);};},decorate:function(decorator){var fn=this;var fnWrapper=function(){return decorator.call(this,fn,arguments,fnWrapper);};decorator.call(this,undefined,arguments,fnWrapper);return fnWrapper;}});Namespace.methods({define:function(closure){this._isDefined=true;this._closure=closure;if(namespaceT.logLevel<=1){console.info("Namespace '"+this._path+"' defined.");}
if(closure){Namespace.defining=this;closure(this);Namespace.defining=undefined;}
return this;},defineOnce:function(callback){if(this._isDefined){if(namespaceT.logLevel<=2){console.warn("Namespace '"+this._path+"' redefinition.");}
return this;}
return this.define(callback);},extend:function(){var args=[this].concat(copyArray(arguments));return extendObject.apply(undefined,args);},nameOf:function(symbol){symbol=symbol.replace(/-/g,'_');return'namespace.'+this._path+'.'+symbol;}});extendObject(namespaceT,{_isDefined:true,lookup:function(path){var fCreated=false;path=path.replace(/-/g,'_');var parts=path.split('.');var cur=namespaceT;for(var i=0;i<parts.length;i++){var name=parts[i];if(name==''){continue;}
if(cur[name]===undefined){cur=new Namespace(cur,name);fCreated=true;}
else{cur=cur[name];}}
if(Namespace.defining){Namespace.defining._referenced.push(cur);if(fCreated){if(namespaceT.logLevel<=2){console.warn("Forward reference from "+
Namespace.defining._path+" to "+
path+".");}}}
return cur;}});namespaceT.lookup('util').extend({extendObject:extendObject,copyArray:copyArray}).defineOnce();return namespaceT;}());
/* Begin file: debug.js */
namespace.lookup('org.startpad.debug').defineOnce(function(ns){var util=namespace.util;var reFuncName=/^function\s+(\S+)\s*\(/;function getFunctionName(func){if(typeof func!='function'){return"notAFunction";}
var result=reFuncName.exec(func.toString());if(result==null){return"anonymous";}
return result[1];}
function Logger(active){this.activate(active);this.logged={};}
Logger.methods({activate:function(f){this.active=(f==undefined)?true:f;},log:function(message,options){if(!this.active){return;}
if(options==undefined){options={};}
if(!options.hasOwnProperty('level')){options.level='log';}
if(options.once){if(this.logged[message]){return;}
this.logged[message]=true;}
if(options.hasOwnProperty('obj')){console[options.level](message,options.obj);}else{console[options.level](message);}}});function setLogger(logger){var oldLogger=ns.logger;ns.logger=logger;ns.log=logger.log.fnMethod(logger);return oldLogger;}
function deprecated(fn,args,fnWrapper){if(fn==undefined){fnWrapper.deprecated=getFunctionName(this);if(args[1]){fnWrapper.warning=' - '+args[1];}
return;}
ns.log("{0} is a deprecated function{1}".format(fnWrapper.deprecated||getFunctionName(fn),fnWrapper.warning),{level:'info',once:true});return fn.apply(this,args);}
function alias(fn,args,fnWrapper){if(fn==undefined){fnWrapper.aliasName=args[1];fnWrapper.preferred=args[2]||getFunctionName(this);return;}
ns.log("{0} is deprecated - use {1} instead.".format(fnWrapper.aliasName,fnWrapper.preferred),{level:'info',once:true});return fn.apply(this,args);}
setLogger(new Logger());ns.extend({'getFunctionName':getFunctionName,'Logger':Logger,'setLogger':setLogger,'deprecated':deprecated,'alias':alias});});
/* Begin file: base.js */
namespace.lookup('org.startpad.base').defineOnce(function(ns){var util=namespace.util;function Enum(args){var j=0;for(var i=0;i<arguments.length;i++){if(typeof arguments[i]=="string"){this[arguments[i]]=j++;}
else{j=arguments[i];}}}
Enum.methods({getName:function(value){for(var prop in this){if(this.hasOwnProperty(prop)){if(this[prop]==value){return prop;}}}}});function StBuf(){this.clear();this.append.apply(this,arguments);}
StBuf.methods({append:function(){for(var ist=0;ist<arguments.length;ist++){this.rgst.push(arguments[ist].toString());}
return this;},clear:function(){this.rgst=[];},toString:function(){return this.rgst.join("");}});function extendIfMissing(oDest,var_args){if(oDest==undefined){oDest={};}
for(var i=1;i<arguments.length;i++){var oSource=arguments[i];for(var prop in oSource){if(oSource.hasOwnProperty(prop)&&oDest[prop]==undefined){oDest[prop]=oSource[prop];}}}
return oDest;}
function extendDeep(dest){for(var i=1;i<arguments.length;i++){var src=arguments[i];for(var prop in src){if(src.hasOwnProperty(prop)){if(src[prop]instanceof Array){dest[prop]=[];ns.extendDeep(dest[prop],src[prop]);}
else if(src[prop]instanceof Object){dest[prop]={};ns.extendDeep(dest[prop],src[prop]);}
else{dest[prop]=src[prop];}}}}
return dest;}
function randomInt(n){return Math.floor(Math.random()*n);}
function strip(s){return(s||"").replace(/^\s+|\s+$/g,"");}
function project(obj,asProps){var objT={};for(var i=0;i<asProps.length;i++){var name=asProps[i];if(obj&&obj.hasOwnProperty(name)){objT[name]=obj[name];}}
return objT;}
function keys(map){var list=[];for(var prop in map){if(map.hasOwnProperty(prop)){list.push(prop);}}
return list;}
function isArguments(a){return typeof a=='object'&&a.length!=undefined&&a.callee!=undefined;}
function unique(a){if(!(a instanceof Array)){return;}
a.sort();for(var i=1;i<a.length;i++){if(a[i-1]==a[i]){a.splice(i,1);}}}
function generalType(o){var t=typeof(o);if(t!='object'){return t;}
if(o instanceof String){return'string';}
if(o instanceof Number){return'number';}
return t;}
function isEqual(a,b){if(a===b){return true;}
if(generalType(a)!=generalType(b)){return false;}
if(a==b){return true;}
if(typeof a!='object'){return false;}
if(a instanceof Object!=b instanceof Object){return false;}
if(a instanceof Date||b instanceof Date){if(a instanceof Date!=b instanceof Date||a.getTime()!=b.getTime()){return false;}}
var allKeys=[].concat(keys(a),keys(b));unique(allKeys);for(var i=0;i<allKeys.length;i++){var prop=allKeys[i];if(!isEqual(a[prop],b[prop])){return false;}}
return true;}
function extendIfChanged(dest,last,latest){var f=false;for(var prop in latest){if(latest.hasOwnProperty(prop)){var value=latest[prop];if(value==undefined){continue;}
if(!isEqual(last[prop],value)){last[prop]=value;dest[prop]=value;f=true;}}}
return f;}
function ensureArray(a){if(a==undefined){a=[];}else if(isArguments(a)){a=util.copyArray(a);}else if(!(a instanceof Array)){a=[a];}
return a;}
function indexOf(value,a){a=ensureArray(a);for(var i=0;i<a.length;i++){if(value==a[i]){return i;}}
return-1;}
function map(a,fn){a=ensureArray(a);var aRes=[];for(var i=0;i<a.length;i++){aRes.push(fn(a[i]));}
return aRes;}
function filter(a,fn){a=ensureArray(a);var aRes=[];for(var i=0;i<a.length;i++){if(fn(a[i])){aRes.push(a[i]);}}
return aRes;}
function reduce(a,fn){a=ensureArray(a);if(a.length<2){return a[0];}
var res=a[0];for(var i=1;i<a.length;i++){res=fn(res,a[i]);}
return res;}
function forEach(a,fn){var ret;if(a instanceof Array||a.length!=undefined){for(var i=0;i<a.length;i++){if(a[i]!=undefined){ret=fn(a[i],i);if(ret===false){return;}}}
return;}
for(var prop in a){if(a.hasOwnProperty(prop)){ret=fn(a[prop],prop);if(ret===false){return;}}}}
function dictFromArray(a,keyName){var d={};for(var i=0;i<a.length;i++){if(a[i]===undefined||!(keyName in a[i])){continue;}
d[a[i][keyName]]=a[i];}
return d;}
ns.extend({'extendObject':util.extendObject,'Enum':Enum,'StBuf':StBuf,'extendIfMissing':extendIfMissing,'extendIfChanged':extendIfChanged,'extendDeep':extendDeep,'randomInt':randomInt,'strip':strip,'project':project,'uniqueArray':unique,'unique':unique,'indexOf':indexOf,'map':map,'filter':filter,'reduce':reduce,'keys':keys,'forEach':forEach,'ensureArray':ensureArray,'isEqual':isEqual,'dictFromArray':dictFromArray});});
/* Begin file: format.js */
namespace.lookup('org.startpad.format').defineOnce(function(ns){var util=namespace.util;var base=namespace.lookup('org.startpad.base');var debug=namespace.lookup('org.startpad.debug');var logger=new debug.Logger(false);var comma=',';function fixedDigits(value,digits,fSign){var s="";var fNeg=(value<0);if(digits==undefined){digits=0;}
if(fNeg){value=-value;}
value=Math.floor(value);for(;digits>0;digits--){s=(value%10)+s;value=Math.floor(value/10);}
if(fSign||fNeg){s=(fNeg?"-":"+")+s;}
return s;}
function thousands(value,digits){var integerPart=Math.floor(value);var s=integerPart.toString();var sLast="";while(s!=sLast){sLast=s;s=s.replace(/(\d+)(\d{3})/,"$1"+comma+"$2");}
var fractionString="";if(digits&&digits>=1){digits=Math.floor(digits);var fraction=value-integerPart;fraction=Math.floor(fraction*Math.pow(10,digits));fractionString="."+fixedDigits(fraction,digits);}
return s+fractionString;}
function slugify(s){s=base.strip(s).toLowerCase();s=s.replace(/[^a-zA-Z0-9]/g,'-').replace(/[\-]+/g,'-').replace(/(^-+)|(-+$)/g,'');return s;}
function escapeHTML(s){s=s.toString();s=s.replace(/&/g,'&amp;');s=s.replace(/</g,'&lt;');s=s.replace(/>/g,'&gt;');s=s.replace(/\"/g,'&quot;');s=s.replace(/'/g,'&#39;');return s;}
var tzDefault=0;function setTimezone(tz){if(tz==undefined){tz=-(new Date().getTimezoneOffset())/60;}
tzDefault=tz;}
function isoFromDate(dt,fTime){var dtT=new Date();dtT.setTime(dt.getTime());var tz=dt.__tz;if(tz==undefined){tz=tzDefault;}
if(tz!=0){dtT.setTime(dtT.getTime()+60*60*1000*tz);}
var s=dtT.getUTCFullYear()+"-"+
fixedDigits(dtT.getUTCMonth()+1,2)+"-"+
fixedDigits(dtT.getUTCDate(),2);var ms=dtT%(24*60*60*1000);if(ms||fTime||tz!=0){s+="T"+fixedDigits(dtT.getUTCHours(),2)+":"+
fixedDigits(dtT.getUTCMinutes(),2);ms=ms%(60*1000);if(ms){s+=":"+fixedDigits(dtT.getUTCSeconds(),2);}
if(ms%1000){s+="."+fixedDigits(dtT.getUTCMilliseconds(),3);}
if(tz==0){s+="Z";}else{s+=fixedDigits(tz,2,true);}}
return s;}
var regISO=new RegExp("^(\\d{4})-?(\\d\\d)-?(\\d\\d)"+"(T(\\d\\d):?(\\d\\d):?((\\d\\d)"+"(\\.(\\d{0,6}))?)?(Z|[\\+-]\\d\\d))?$");function dateFromISO(sISO){var e=new base.Enum(1,"YYYY","MM","DD",5,"hh","mm",8,"ss",10,"sss","tz");var aParts=sISO.match(regISO);if(!aParts){return undefined;}
aParts[e.mm]=aParts[e.mm]||0;aParts[e.ss]=aParts[e.ss]||0;aParts[e.sss]=aParts[e.sss]||0;aParts[e.sss]=Math.round(+('0.'+aParts[e.sss])*1000);if(!aParts[e.tz]||aParts[e.tz]==="Z"){aParts[e.tz]=0;}else{aParts[e.tz]=parseInt(aParts[e.tz]);}
if(aParts[e.MM]>59||aParts[e.DD]>31||aParts[e.hh]>23||aParts[e.mm]>59||aParts[e.ss]>59||aParts[e.tz]<-23||aParts[e.tz]>23){return undefined;}
var dt=new Date();dt.setUTCFullYear(aParts[e.YYYY],aParts[e.MM]-1,aParts[e.DD]);if(aParts[e.hh]){dt.setUTCHours(aParts[e.hh],aParts[e.mm],aParts[e.ss],aParts[e.sss]);}else{dt.setUTCHours(0,0,0,0);}
dt.__tz=aParts[e.tz];if(aParts[e.tz]){dt.setTime(dt.getTime()-dt.__tz*(60*60*1000));}
return dt;}
function decodeClass(obj){if(obj==undefined||obj.__class__==undefined){return undefined;}
if(obj.__class__=='Date'){return dateFromISO(obj.isoformat);}
return undefined;}
function shortDate(d){if(!(d instanceof Date)){return undefined;}
var s=(d.getMonth()+1)+'/'+
(d.getDate())+'/'+
(d.getFullYear());var hr=d.getHours();var ampm=' am';if(hr>=12){ampm=' pm';}
hr=hr%12;if(hr==0){hr=12;}
var sT=hr+':'+fixedDigits(d.getMinutes(),2)+ampm;if(sT!='12:00 am'){s+=' '+sT;}
return s;}
function wordList(a){a=base.map(a,base.strip);a=base.filter(a,function(s){return s!='';});return a.join(', ');}
function arrayFromWordList(s){s=base.strip(s);var a=s.split(/[ ,]+/);a=base.filter(a,function(s){return s!='';});return a;}
var base64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function base64ToString(base64){var b;if(typeof atob=="function"){return atob(base64);}
base64=base64.replace(/[^A-Z0-9+\/]/ig,"");for(var chars=[],i=0,imod4=0;i<base64.length;imod4=++i%4){if(imod4==0){continue;}
b=((base64map.indexOf(base64.charAt(i-1))&(Math.pow(2,-2*imod4+8)-1))<<(imod4*2))|(base64map.indexOf(base64.charAt(i))>>>(6-imod4*2));chars.push(String.fromCharCode(b));}
return chars.join('');}
function canvasToPNG(canvas){var prefix="data:image/png;base64,";var data=canvas.toDataURL('image/png');if(data.indexOf(prefix)!=0){return undefined;}
return data.substr(prefix.length);}
function repeat(s,times){return new Array(times+1).join(s);}
var reFormat=/\{\s*([^} ]+)\s*\}/g;function formatImpl(re){var st=this.toString();var args=Array.prototype.slice.call(arguments,1);if(args.length==1&&typeof args[0]=='object'){args=args[0];}
st=st.replace(re,function(whole,key){var value=args;var keys=key.split('.');for(var i=0;i<keys.length;i++){key=keys[i];var n=parseInt(key);if(!isNaN(n)){value=value[n];}else{value=value[key];}
if(value==undefined){logger.log("missing key: "+keys.slice(0,i+1).join('.'),{once:true});return"";}}
return value;});return st;}
function format(st){var args=util.copyArray(arguments);args.splice(0,1,reFormat);return formatImpl.apply(st,args);}
String.prototype.format=function(){var args=util.copyArray(arguments);args.unshift(reFormat);return formatImpl.apply(this,args);};function parseURLParams(url){var parts=url.match(/([^?#]*)(#.*)?$/);if(!parts){return{};}
var results={};if(parts[2]){results._anchor=decodeURIComponent(parts[2].slice(1));}
parts=parts[1].split("&");for(var i=0;i<parts.length;i++){var ich=parts[i].indexOf("=");var name;var value;if(ich===-1){name=parts[i];value="";}else{name=parts[i].slice(0,ich);value=parts[i].slice(ich+1);}
results[decodeURIComponent(name)]=decodeURIComponent(value);}
return results;}
ns.extend({'fixedDigits':fixedDigits,'thousands':thousands,'slugify':slugify,'escapeHTML':escapeHTML,'format':format,'replaceKeys':format.decorate(debug.alias,'replaceKeys'),'base64ToString':base64ToString,'canvasToPNG':canvasToPNG,'dateFromISO':dateFromISO,'isoFromDate':isoFromDate,'setTimezone':setTimezone,'decodeClass':decodeClass,'shortDate':shortDate,'wordList':wordList,'arrayFromWordList':arrayFromWordList,'repeat':repeat,'parseURLParams':parseURLParams});});
/* Begin file: vector.js */
namespace.lookup('org.startpad.vector').defineOnce(function(ns){var util=namespace.util;var x=0;var y=1;var x2=2;var y2=3;var regNums={'ul':0,'top':1,'ur':2,'left':3,'center':4,'right':5,'ll':6,'bottom':7,'lr':8};function subFrom(v1,v2){for(var i=0;i<v1.length;i++){v1[i]=v1[i]-v2[i%v2.length];}
return v1;}
function copy(){var v1=Array.prototype.concat.apply([],arguments);return v1;}
function sub(v1,v2){var vDiff=copy(v1);return subFrom(vDiff,v2);}
function addTo(vSum){for(var iarg=1;iarg<arguments.length;iarg++){var v=arguments[iarg];for(var i=0;i<vSum.length;i++){vSum[i]+=v[i%v.length];}}
return vSum;}
function add(){var vSum=copy(arguments[0]);var args=util.copyArray(arguments);args[0]=vSum;return addTo.apply(undefined,args);}
function max(){var vMax=copy(arguments[0]);for(var iarg=1;iarg<arguments.length;iarg++){var v=arguments[iarg];for(var i=0;i<vMax.length;i++){if(v[i]>vMax[i]){vMax[i]=v[i];}}}
return vMax;}
function mult(){var vProd=1;var i;for(var iarg=0;iarg<arguments.length;iarg++){var v=arguments[iarg];if(typeof v==="number"){if(typeof vProd==="number"){vProd*=v;}
else{for(i=0;i<vProd.length;i++){vProd[i]*=v;}}}
else{if(typeof vProd==="number"){var vT=vProd;vProd=copy(v);for(i=0;i<vProd.length;i++){vProd[i]*=vT;}}
else{if(v.length!==vProd.length){throw new Error("Mismatched Vector Size");}
for(i=0;i<vProd.length;i++){vProd[i]*=v[i];}}}}
return vProd;}
function floor(v){var vFloor=[];for(var i=0;i<v.length;i++){vFloor[i]=Math.floor(v[i]);}
return vFloor;}
function dotProduct(){var v=mult.apply(undefined,arguments);var s=0;for(var i=0;i<v.length;i++){s+=v[i];}
return s;}
function equal(v1,v2){if(v1.length!=v2.length){return false;}
for(var i=0;i<v1.length;i++){if(typeof v1[i]!=typeof v2[i]){return false;}
if(typeof v1[i]=="object"){if(!equal(v1[i],v2[i])){return false;}}else{if(v1[i]!=v2[i]){return false;}}}
return true;}
function ul(rc){return rc.slice(0,2);}
function lr(rc){return rc.slice(2,4);}
function size(rc){return sub(lr(rc),ul(rc));}
function area(rc){var dv=size(rc);return dv[0]*dv[1];}
function numInRange(num,numMin,numMax){return num>=numMin&&num<=numMax;}
function clipToRange(num,numMin,numMax){if(num<numMin){return numMin;}
if(num>numMax){return numMax;}
return num;}
function ptInRect(pt,rc){return numInRange(pt[x],rc[x],rc[x2])&&numInRange(pt[y],rc[y],rc[y2]);}
function ptClipToRect(pt,rc){return[clipToRange(pt[x],rc[x],rc[x2]),clipToRange(pt[y],rc[y],rc[y2])];}
function rcClipToRect(rc,rcClip){return copy(ptClipToRect(ul(rc),rcClip),ptClipToRect(lr(rc),rcClip));}
function ptCenter(rc,scale){if(scale===undefined){scale=0.5;}
if(typeof scale==="number"){scale=[scale,scale];}
var pt=mult(scale,lr(rc));scale=sub([1,1],scale);addTo(pt,mult(scale,ul(rc)));return pt;}
function rcExpand(rc,ptSize){var rcExp=copy(sub(ul(rc),ptSize),add(lr(rc),ptSize));var ptC=ptCenter(rc);if(rcExp[x]>rcExp[x2]){rcExp[x]=rcExp[x2]=ptC[x];}
if(rcExp[y]>rcExp[y2]){rcExp[y]=rcExp[y2]=ptC[y];}
return rcExp;}
function keepInRect(rcIn,rcBound){var ptFixSize=max([0,0],sub(size(rcIn),size(rcBound)));rcIn[x2]-=ptFixSize[x];rcIn[y2]-=ptFixSize[y];var dx=0;var dy=0;dx=Math.max(0,rcBound[x]-rcIn[x]);dy=Math.max(0,rcBound[y]-rcIn[y]);if(dx==0){dx=Math.min(0,rcBound[x2]-rcIn[x2]);}
if(dy==0){dy=Math.min(0,rcBound[y2]-rcIn[y2]);}
addTo(rcIn,[dx,dy]);}
function ptRegistration(rc,reg){if(typeof reg=='string'){reg=regNums[reg];}
var xScale=(reg%3)*0.5;var yScale=Math.floor(reg/3)*0.5;return ptCenter(rc,[xScale,yScale]);}
function magnitude2(v1){var d2=0;for(var i=0;i<v1.length;i++){d2+=Math.pow(v1[i],2);}
return d2;}
function distance2(v1,v2){var dv=sub(v2,v1);return magnitude2(dv);}
function unitVector(v1){var m2=magnitude2(v1);return mult(v1,1/Math.sqrt(m2));}
function iPtClosest(pt){var d2Min;var ptClosest;var iClosest;var d2;var iPt=0;for(var iarg=1;iarg<arguments.length;iarg++){var v=arguments[iarg];if(typeof v[0]=="number"){d2=distance2(pt,v);if(d2Min==undefined||d2<d2Min){d2Min=d2;ptClosest=v;iClosest=iPt;}
iPt++;}
else{for(var i=0;i<v.length;i++){var vT=v[i];d2=distance2(pt,vT);if(d2Min==undefined||d2<d2Min){d2Min=d2;ptClosest=vT;iClosest=iPt;}
iPt++;}}}
return[iClosest,ptClosest];}
function iRegClosest(pt,rc){var aPoints=[];for(var i=0;i<9;i++){aPoints.push(ptRegistration(rc,i));}
return iPtClosest(pt,aPoints)[0];}
function alignRect(rc,reg,ptTo){var ptFrom=ptRegistration(rc,reg);return add(rc,sub(ptTo,ptFrom));}
function rcDeltaReg(rc,dpt,iReg,ptSizeMin,rcBounds){var rcT;if(iReg==4){rcT=add(rc,dpt);if(rcBounds){keepInRect(rcT,rcBounds);}
return rcT;}
var iX=iReg%3;if(iX==1){iX=undefined;}
var iY=Math.floor(iReg/3);if(iY==1){iY=undefined;}
function applyDelta(rc,dpt){var rcDelta=[0,0,0,0];if(iX!=undefined){rcDelta[iX]=dpt[0];}
if(iY!=undefined){rcDelta[iY+1]=dpt[1];}
return add(rc,rcDelta);}
rcT=applyDelta(rc,dpt);if(!ptSizeMin){ptSizeMin=[0,0];}
var ptSize=size(rcT);var ptFixSize=max([0,0],sub(ptSizeMin,ptSize));if(iX==0){ptFixSize[0]*=-1;}
if(iY==0){ptFixSize[1]*=-1;}
rcT=applyDelta(rcT,ptFixSize);if(rcBounds){keepInRect(rcT,rcBounds);}
return rcT;}
function boundingBox(){var vPoints=copy.apply(undefined,arguments);if(vPoints.length%2!==0){throw new Error("Invalid arguments to boundingBox");}
var ptMin=vPoints.slice(0,2),ptMax=vPoints.slice(0,2);for(var ipt=2;ipt<vPoints.length;ipt+=2){var pt=vPoints.slice(ipt,ipt+2);if(pt[0]<ptMin[0]){ptMin[0]=pt[0];}
if(pt[1]<ptMin[1]){ptMin[1]=pt[1];}
if(pt[0]>ptMax[0]){ptMax[0]=pt[0];}
if(pt[1]>ptMax[1]){ptMax[1]=pt[1];}}
return[ptMin[0],ptMin[1],ptMax[0],ptMax[1]];}
ns.extend({'x':x,'y':y,'x2':x2,'y2':y2,'equal':equal,'sub':sub,'subFrom':subFrom,'add':add,'addTo':addTo,'max':max,'mult':mult,'distance2':distance2,'magnitude2':magnitude2,'unitVector':unitVector,'floor':floor,'dotProduct':dotProduct,'ul':ul,'lr':lr,'copy':copy,'append':copy,'size':size,'area':area,'numInRange':numInRange,'clipToRange':clipToRange,'ptInRect':ptInRect,'ptClipToRect':ptClipToRect,'rcClipToRect':rcClipToRect,'ptCenter':ptCenter,'boundingBox':boundingBox,'ptRegistration':ptRegistration,'rcExpand':rcExpand,'alignRect':alignRect,'keepInRect':keepInRect,'iRegClosest':iRegClosest,'rcDeltaReg':rcDeltaReg});});
/* Begin file: dom.js */
namespace.lookup('org.startpad.dom').define(function(ns){var util=namespace.util;var vector=namespace.lookup('org.startpad.vector');var base=namespace.lookup('org.startpad.base');var ix=0;var iy=1;var ix2=2;var iy2=3;function getPos(elt){var offset=jQuery(elt).offset();return[offset.left,offset.top];}
function getSize(elt){return[elt.offsetWidth,elt.offsetHeight];}
function getRect(elt){var rc=getPos(elt);var ptSize=getSize(elt);rc.push(rc[ix]+ptSize[ix],rc[iy]+ptSize[iy]);return rc;}
function getOffsetRect(elt){var rc=[elt.offsetLeft,elt.offsetTop];var ptSize=getSize(elt);rc.push(rc[ix]+ptSize[ix],rc[iy]+ptSize[iy]);return rc;}
function getMouse(evt){var x=document.documentElement.scrollLeft||document.body.scrollLeft;var y=document.documentElement.scrollTop||document.body.scrollTop;return[x+evt.clientX,y+evt.clientY];}
function getWindowRect(){var x=document.documentElement.scrollLeft||document.body.scrollLeft;var y=document.documentElement.scrollTop||document.body.scrollTop;var dx=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var dy=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return[x,y,x+dx,y+dy];}
function setPos(elt,pt){elt.style.left=pt[0]+'px';elt.style.top=pt[1]+'px';}
function setSize(elt,pt){elt.style.width=pt[0]+'px';elt.style.height=pt[1]+'px';}
function setRect(elt,rc){setPos(elt,vector.ul(rc));setSize(elt,vector.size(rc));}
function removeChildren(node){var child;for(child=node.firstChild;child;child=node.firstChild){node.removeChild(child);}}
function ancestors(elem){var aAncestors=[];while(elem!=document){aAncestors.push(elem);elem=elem.parentNode;}
return aAncestors;}
function commonAncestorHeight(elemChild,elemUncle){var aChild=ancestors(elemChild);var aUncle=ancestors(elemUncle);var iChild=aChild.length-1;var iUncle=aUncle.length-1;while(aChild[iChild]==aUncle[iUncle]&&iChild>=0){iChild--;iUncle--;}
return iChild+1;}
function setFocusIfVisible(elt){if(!elt){return;}
var rcElt=getRect(elt);var rcWin=getWindowRect();if(vector.PtInRect(vector.UL(rcElt),rcWin)||vector.PtInRect(vector.LR(rcElt),rcWin)){elt.focus();}}
function scrollToBottom(elt){elt.scrollTop=elt.scrollHeight;}
function slide(div,pt,animation,fnCallback){if(div.style.display!='block'){div.style.display='block';}
var rcPanel=getRect(div);var panelSize=getSize(div);var reg=animation=='show'?'lr':'ur';rcPanel=vector.alignRect(rcPanel,reg,pt);setPos(div,rcPanel);if(animation=='show'){jQuery(div).animate({top:'+='+panelSize[1]},fnCallback);return;}
if(animation=='hide'){jQuery(div).animate({top:'-='+panelSize[1]},function(){jQuery(this).hide();if(fnCallback){fnCallback();}});}}
function bindIDs(aIDs){var mParts={};var i;if(aIDs===undefined){var aAll=document.getElementsByTagName("*");for(i=0;i<aAll.length;i++){var elt=aAll[i];if(elt.id&&elt.id[0]!='_'){mParts[elt.id]=elt;}}
return mParts;}
for(i=0;i<aIDs.length;i++){var sID=aIDs[i];mParts[sID]=document.getElementById(sID);}
return mParts;}
function initValues(aNames,mpFields,mpValues){for(var i=0;i<aNames.length;i++){if(mpValues[aNames[i]]!=undefined){mpFields[aNames[i]].value=mpValues[aNames[i]];}}}
function readValues(aNames,mpFields,mpValues){for(var i=0;i<aNames.length;i++){var field=mpFields[aNames[i]];var value;if(field.type=='checkbox'){value=field.checked;}else{value=field.value;}
mpValues[aNames[i]]=value;}}
function $(sSelector){var ch=sSelector.substr(0,1);if(ch=='.'||ch=='#'){sSelector=sSelector.substr(1);}
if(ch=='#'){return document.getElementById(sSelector);}
if(ch=='.'){return ns.getElementsByClassName(sSelector);}
return document.getElementsByTagName(sSelector);}
function getElementsByClassName(sClassName){if(document.getElementsByClassName){return document.getElementsByClassName(sClassName);}
return ns.GetElementsByTagClassName(document,"*",sClassName);}
function getElementsByTagClassName(oElm,strTagName,strClassName){var arrElements=(strTagName=="*"&&oElm.all)?oElm.all:oElm.getElementsByTagName(strTagName);var arrReturnElements=[];strClassName=strClassName.replace(/\-/g,"\\-");var oRegExp=new RegExp("(^|\\s)"+strClassName+"(\\s|$)");var oElement;for(var i=0;i<arrElements.length;i++){oElement=arrElements[i];if(oRegExp.test(oElement.className)){arrReturnElements.push(oElement);}}
return(arrReturnElements);}
function getText(elt){return base.strip(elt.textContent||elt.innerText);}
function setText(elt,st){if(elt.textContent!=undefined){elt.textContent=st;}else{elt.innerText=st;}}
function wrapEvent(evt)
{evt=evt||window.evt||{};if(!evt.preventDefault){evt.preventDefault=function(){this.returnValue=false;};}
if(!evt.stopPropagation){evt.stopPropagation=function(){this.cancelBubble=true;};}
if(!evt.target){evt.target=evt.srcElement||document;}
if(evt.pageX==null&&evt.clientX!=null){var doc=document.documentElement;var body=document.body;evt.pageX=evt.clientX+
(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-
(doc.clientLeft||0);evt.pageY=evt.clientY+
(doc&&doc.scrollTop||body&&body.scrollTop||0)-
(doc.clientTop||0);}
return evt;}
var handlers=[];function bind(elt,event,fnCallback,capture){if(!capture){capture=false;}
var fnWrap=function(){var args=util.copyArray(arguments);args[0]=wrapEvent(args[0]);return fnCallback.apply(elt,arguments);};if(elt.addEventListener){elt.addEventListener(event,fnWrap,capture);}else if(elt.attachEvent){elt.attachEvent('on'+event,fnWrap);}else{elt['on'+event]=fnWrap;}
handlers.push({'elt':elt,'event':event,'capture':capture,'fn':fnWrap});return handlers.length-1;}
function unbind(i){var handler=handlers[i];if(handler==undefined){return;}
handlers[i]=undefined;var elt=handler.elt;if(elt.removeEventListener){elt.removeEventListener(handler.event,handler.fn,handler.capture);}
else if(elt.attachEvent){elt.detachEvent('on'+handler.event,handler.fn);}
else{elt['on'+handler.event]=undefined;}}
ns.extend({'getPos':getPos,'getSize':getSize,'getRect':getRect,'getOffsetRect':getOffsetRect,'getMouse':getMouse,'getWindowRect':getWindowRect,'setPos':setPos,'setSize':setSize,'setRect':setRect,'removeChildren':removeChildren,'ancestors':ancestors,'commonAncestorHeight':commonAncestorHeight,'setFocusIfVisible':setFocusIfVisible,'scrollToBottom':scrollToBottom,'bindIDs':bindIDs,'initValues':initValues,'readValues':readValues,'$':$,'select':$,'getElementsByClassName':getElementsByClassName,'getElementsByTagClassName':getElementsByTagClassName,'getText':getText,'setText':setText,'slide':slide,'bind':bind,'unbind':unbind});});
/* Begin file: cookies.js */
namespace.lookup('org.startpad.cookies').define(function(ns){var base=namespace.lookup('org.startpad.base');function setCookie(name,value,days,path){var expires='';if(days){var date=new Date();date.setTime(date.getTime()+days*24*60*60*1000);expires='; expires='+date.toGMTString();}
path='; path='+(path||'/');document.cookie=encodeURIComponent(name)+'='+
encodeURIComponent(value)+expires+path;}
function getCookie(name){return ns.getCookies()[name];}
function getCookies(name){var st=document.cookie;var rgPairs=st.split(";");var obj={};for(var i=0;i<rgPairs.length;i++){rgPairs[i]=base.strip(rgPairs[i]);var rgC=rgPairs[i].split("=");var val=decodeURIComponent(rgC[1]);var rg=val.match('^"(.*)"$');if(rg){val=rg[1].replace('\\"','"');}
obj[decodeURIComponent(rgC[0])]=val;}
return obj;}
ns.extend({setCookie:setCookie,getCookie:getCookie,getCookies:getCookies});});
/* Begin file: random.js */
namespace.lookup("org.startpad.random").defineOnce(function(ns){ns.upper='ABCDEFGHIJKLMNOPQRSTUVWXYZ';ns.lower='abcdefghijklmnopqrstuvwxyz';ns.digits='0123456789';ns.base64=ns.upper+ns.lower+ns.digits+'+/';ns.base64url=ns.upper+ns.lower+ns.digits+'-_';ns.hexdigits=ns.digits+'abcdef';ns.randomString=function(len,chars){if(typeof chars=='undefined'){chars=ns.base64url;}
var radix=chars.length;var result=[];for(var i=0;i<len;i++){result[i]=chars[0|Math.random()*radix];}
return result.join('');};});
/* Begin file: crypto.js */
(function(){var C=namespace.lookup('com.googlecode.crypto-js');var types=C.types={};var WordArray=types.WordArray={getSigBytes:function(words){if(words["_Crypto"]&&words["_Crypto"].sigBytes!=undefined){return words["_Crypto"].sigBytes;}else{return words.length*4;}},setSigBytes:function(words,n){words["_Crypto"]={sigBytes:n};},cat:function(w1,w2){return ByteStr.decode(ByteStr.encode(w1)+ByteStr.encode(w2));}};var enc=C.enc={};var ByteStr=enc.ByteStr={encode:function(words){var sigBytes=WordArray.getSigBytes(words);var str=[];for(var i=0;i<sigBytes;i++){str.push(String.fromCharCode((words[i>>>2]>>>(24-(i%4)*8))&0xFF));}
return str.join("");},decode:function(str){var words=[];for(var i=0;i<str.length;i++){words[i>>>2]|=str.charCodeAt(i)<<(24-(i%4)*8);}
WordArray.setSigBytes(words,str.length);return words;}};enc.UTF8={encode:function(words){return decodeURIComponent(escape(ByteStr.encode(words)));},decode:function(str){return ByteStr.decode(unescape(encodeURIComponent(str)));}};enc.Words={encode:function(words){return words;},decode:function(words){return words;}};})();(function(){var C=namespace.lookup('com.googlecode.crypto-js');var WordArray=C.types.WordArray;C.enc.Hex={encode:function(words){var sigBytes=WordArray.getSigBytes(words);var hex=[];for(var i=0;i<sigBytes;i++){var bite=(words[i>>>2]>>>(24-(i%4)*8))&0xFF;hex.push((bite>>>4).toString(16));hex.push((bite&0xF).toString(16));}
return hex.join("");},decode:function(hex){var words=[];for(var i=0;i<hex.length;i+=2){words[i>>>3]|=parseInt(hex.substr(i,2),16)<<(24-(i%8)*4);}
WordArray.setSigBytes(words,hex.length/2);return words;}};})();(function(){var C=namespace.lookup('com.googlecode.crypto-js');var WordArray=C.types.WordArray;var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";C.enc.Base64={encode:function(words){var sigBytes=WordArray.getSigBytes(words);var b64str=[];for(var i=0;i<sigBytes;i+=3){var triplet=(((words[(i)>>>2]>>>(24-((i)%4)*8))&0xFF)<<16)|(((words[(i+1)>>>2]>>>(24-((i+1)%4)*8))&0xFF)<<8)|((words[(i+2)>>>2]>>>(24-((i+2)%4)*8))&0xFF);for(var j=0;j<4;j++){if(i+j*0.75<=sigBytes){b64str.push(b64map.charAt((triplet>>>(6*(3-j)))&0x3F));}else{b64str.push("=");}}}
return b64str.join("");},decode:function(b64str){b64str=b64str.replace(/=+$/,"");var words=[];for(var i=0,bites=0;i<b64str.length;i++){if(i%4){words[bites>>>2]|=(((b64map.indexOf(b64str.charAt(i-1))<<((i%4)*2))|(b64map.indexOf(b64str.charAt(i))>>>(6-(i%4)*2)))&0xFF)<<(24-(bites%4)*8);bites++;}}
WordArray.setSigBytes(words,bites);return words;}};})();(function(){var C=namespace.lookup('com.googlecode.crypto-js');var UTF8=C.enc.UTF8;var WordArray=C.types.WordArray;var SHA1=C.SHA1=function(message,options){var digestWords=SHA1.digest(message);var output=options&&options.output||C.enc.Hex;return output.encode(digestWords);};SHA1.digest=function(message){var m=message.constructor==String?UTF8.decode(message):message;var l=WordArray.getSigBytes(m)*8;m[l>>>5]|=0x80<<(24-l%32);m[(((l+64)>>>9)<<4)+15]=l;var w=[];var H0=0x67452301;var H1=0xEFCDAB89;var H2=0x98BADCFE;var H3=0x10325476;var H4=0xC3D2E1F0;for(var i=0;i<m.length;i+=16){var a=H0;var b=H1;var c=H2;var d=H3;var e=H4;for(var j=0;j<80;j++){if(j<16)w[j]=m[i+j];else{var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];w[j]=(n<<1)|(n>>>31);}
var t=((H0<<5)|(H0>>>27))+H4+(w[j]>>>0)+(j<20?((H1&H2)|(~H1&H3))+0x5A827999:j<40?(H1^H2^H3)+0x6ED9EBA1:j<60?((H1&H2)|(H1&H3)|(H2&H3))-0x70E44324:(H1^H2^H3)-0x359D3E2A);H4=H3;H3=H2;H2=(H1<<30)|(H1>>>2);H1=H0;H0=t;}
H0+=a;H1+=b;H2+=c;H3+=d;H4+=e;}
return[H0,H1,H2,H3,H4];};SHA1.blockSize=16;})();(function(){var C=namespace.lookup('com.googlecode.crypto-js');var UTF8=C.enc.UTF8;var Words=C.enc.Words;var WordArray=C.types.WordArray;C.HMAC=function(hasher,message,key,options){var m=message.constructor==String?UTF8.decode(message):message;var k=key.constructor==String?UTF8.decode(key):key;if(k.length>hasher.blockSize){k=hasher(k,{output:Words});}
var oKey=k.slice(0);var iKey=k.slice(0);for(var i=0;i<hasher.blockSize;i++){oKey[i]^=0x5C5C5C5C;iKey[i]^=0x36363636;}
var hmacWords=hasher(WordArray.cat(oKey,hasher(WordArray.cat(iKey,m),{output:Words})),{output:Words});var output=options&&options.output||C.enc.Hex;return output.encode(hmacWords);};})();
/* Begin file: forms.js */
namespace.lookup('com.pageforest.forms').define(function(ns){function showValidatorResults(fields,errors,options){var ignoreEmpty=options&&options.ignoreEmpty;for(var index=0;index<fields.length;index++){var name=fields[index];var html=errors[name];if(ignoreEmpty&&$("#id-"+name).val()===''){html='';}else if(html){html='<span class="error">'+html+'</span>';}else{html='<span class="success">OK</span>';}
$("#validate_"+name).html(html);}}
function postFormData(url,data,onSuccess,onValidate,onError){$.ajax({type:"POST",url:url,data:data,dataType:"json",success:function(message,status,xhr){if(message.status==200){if(onSuccess){onSuccess(message,status,xhr);}}else{if(onValidate){onValidate(message,status,xhr);}}},error:onError});}
ns.extend({showValidatorResults:showValidatorResults,postFormData:postFormData});});
/* Begin file: dialog.js */
namespace.lookup('org.startpad.dialog').defineOnce(function(ns){var util=namespace.util;var base=namespace.lookup('org.startpad.base');var format=namespace.lookup('org.startpad.format');var dom=namespace.lookup('org.startpad.dom');var ERROR_STRINGS={minSize:"{label} must have at least {minSize} characters.",maxSize:"{label} must have no more than {maxSize} characters.",required:"{label} is required."};var defaultPatterns={title:{useRow:'spanRow',content:'<h1>{title}</h1>'},text:{content:'<input id="{id}" type="text"/>'},password:{content:'<input id="{id}" type="password"/>'},checkbox:{label:'',content:'<label class="checkbox" for="{id}">'+'<input id="{id}" type="checkbox"/>&nbsp;{label}</label>'},note:{content:'<textarea id="{id}" rows="{rows}"></textarea>'},message:{useRow:'spanRow',content:'<div class="message" id="{id}"></div>'},value:{label:'<label class="left">{label}:</label>',content:'<div class="value" id="{id}"></div>'},button:{useRow:'spanRow',content:'<input id="{id}" type="button" value="{label}"/>'},invalid:{useRow:'spanRow',content:'<span class="error">***missing field type: {type}***</span>'}};var defaultFieldOptions={note:{rows:5}};var styles={div:{pre:'',label:'<label class="left" for="{id}">{label}:</label>',content:'<input id="{id}" type="text"/>',spanRow:'<div id ="{id}-row">{content}</div>\n',row:'<div id="{id}-row">{label}{content}</div>\n',post:'<div style="clear: both;"></div>\n',dialogClass:'sp-dialog-div'},table:{pre:"<table>\n",label:'<label class="left" for="{id}">{label}:</label>',content:'<input id="{id}" type="text"/>',spanRow:'<tr id="{id}-row"><td colspan=2>{content}</td><td></td></tr>',row:'<tr id="{id}-row"><th>{label}</th>'+'<td>{content}</td>'+'<td class=error id="{id}-error"></td></tr>\n',post:"</table>\n",dialogClass:'sp-dialog-table'}};var sDialog='<div class="{dialogClass}" id="{id}">\n'+'{pre}\n{content}\n{post}\n'+'</div>';var cDialogs=0;function Dialog(options){cDialogs++;this.prefix='SP'+cDialogs+'_';this.bound=false;this.lastValues={};this.patterns=defaultPatterns;this.fieldOptions=defaultFieldOptions;this.style=styles.div;util.extendObject(this,options);this.setStyle(this.style);this.fields=util.copyArray(this.fields);}
Dialog.methods({setStyle:function(style){this.style=style;util.extendObject(this,this.style);},html:function(){var self=this;var stb=new base.StBuf();this.id=this.prefix+'dialog';base.forEach(this.fields,function(field,i){field.id=self.prefix+i;if(field.type==undefined){field.type='text';}
base.extendIfMissing(field,self.fieldOptions[field.type]);if(self.patterns[field.type]==undefined){field.type='invalid';}
if(field.label==undefined){field.label=field.name[0].toUpperCase()+
field.name.slice(1);}
var fieldPatterns=base.extendIfMissing({},self.patterns[field.type],base.project(self.style,['label','content']));var row={id:field.id,label:fieldPatterns.label.format(field),content:fieldPatterns.content.format(field)};var rowPattern=self[fieldPatterns.useRow]||self.row;stb.append(rowPattern.format(row));});this.content=stb.toString();return sDialog.format(this);},bindFields:function(){if(this.bound){return;}
this.bound=true;var self=this;self.dlg=document.getElementById(self.id);if(self.dlg==undefined){throw new Error("Dialog not in the DOM.");}
var initialValues={};base.forEach(this.fields,function(field){field.elt=document.getElementById(field.id);if(!field.elt){return;}
field.error=document.getElementById(field.id+'-error');if(field.value){initialValues[field.name]=field.value;}
if(field.onClick!=undefined){dom.bind(field.elt,'click',function(evt){field.onClick(evt,field,self);});}
if(field.onChange!=undefined){dom.bind(field.elt,'keyup',function(evt){field.onChange(evt,field.elt.value,self);});}
if(self.focus==undefined&&(field.elt.tagName=='INPUT'||field.elt.tagName=='TEXTAREA')){self.focus=field.name;}
if(self.enter==undefined&&field.type=='button'){self.enter=field.name;}});if(self.enter){dom.bind(self.dlg,'keydown',function(evt){if(evt.keyCode==13){var field=self.getField(self.enter);if(field.onClick){field.onClick();}}});}
this.setValues(initialValues);this.setFocus();},getField:function(name){this.bindFields();for(var i=0;i<this.fields.length;i++){if(this.fields[i].name==name){return this.fields[i];}}
return undefined;},hasChanged:function(name,fSnapshot){var result,values=this.getValues();if(name!=undefined){result=values[name]!=this.lastValues[name];if(fSnapshot){this.lastValues[name]=values[name];}}else{result=!base.isEqual(values,this.lastValues);if(fSnapshot){this.lastValues=values;}}
return result;},setValues:function(values){var field;base.extendObject(this.lastValues,values);for(var name in values){if(values.hasOwnProperty(name)){field=this.getField(name);if(field==undefined||field.elt==undefined){continue;}
var value=values[name];if(value==undefined){value='';}
switch(field.elt.tagName){case'INPUT':switch(field.elt.type){case'checkbox':field.elt.checked=value;break;case'text':case'password':field.elt.value=value;break;default:break;}
break;case'TEXTAREA':field.elt.value=value;break;default:dom.setText(field.elt,value);break;}}}},clearErrors:function(){base.forEach(this.fields,function(field,i){if(field.error){dom.setText(field.error,'');}});},setErrors:function(errors,options){options=options||{};this.focus=undefined;for(var i=0;i<this.fields.length;i++){var field=this.fields[i];var error=errors[field.name];if(!field.error||error==undefined){continue;}
if(options.ignoreBlanks){var value=options.values[field.name];if(typeof value=='string'&&value.length==0||field.type=='checkbox'){error='';}}
dom.setText(field.error,error);if(error&&!this.focus){this.focus=field.name;}}
this.setFocus();},validate:function(ignoreBlanks){var self=this;var values=this.getValues();var errors={};this.isValid=true;base.forEach(values,function(value,name){var field=self.getField(name);if(!field.error){return;}
if(field.required){if(field.type=='checkbox'&&!value||value.length==0){self.isValid=false;errors[name]=ERROR_STRINGS.required.format(field);}}
if(field.minSize&&value.length<field.minSize){self.isValid=false;errors[name]=ERROR_STRINGS.minSize.format(field);}
if(field.maxSize&&value.length>field.maxSize){self.isValid=false;errors[name]=ERROR_STRINGS.maxSize.format(field);}});this.setErrors(errors,{ignoreBlanks:ignoreBlanks,values:values});return values;},setFocus:function(){var field;this.bindFields();if(this.focus){field=this.getField(this.focus);if(field){field.elt.focus();field.elt.select();}}},getValues:function(){var values={};this.bindFields();for(var i=0;i<this.fields.length;i++){var field=this.fields[i];if(field.elt==undefined){continue;}
var name=field.name;switch(field.elt.tagName){case'INPUT':switch(field.elt.type){case'checkbox':values[name]=field.elt.checked;break;case'text':case'password':values[name]=base.strip(field.elt.value);break;default:break;}
break;case'TEXTAREA':values[name]=base.strip(field.elt.value);break;default:values[name]=base.strip(dom.getText(field.elt));break;}}
return values;},showField:function(name,shown){if(shown==undefined){shown=true;}
var field=this.getField(name);$('#'+field.id+'-row')[shown?'show':'hide']();},enableField:function(name,enabled){if(enabled==undefined){enabled=true;}
var field=this.getField(name);switch(field.elt.tagName){case'INPUT':case'TEXTAREA':field.elt.disabled=!enabled;break;case'DIV':field.elt.style.display=enabled?'block':'none';break;default:throw new Error("Field "+name+" is not a form field.");}},postValues:function(url,options){var self=this;var values=this.getValues();options=options||{};options.values=values;util.extendObject(options.values,options.extra);$.ajax({type:"POST",url:url,data:values,dataType:"json",success:function(message,status,xhr){if(options.onSuccess){options.onSuccess(message);}},error:function(message,status,xhr){if(message.status==400){try{message=JSON.parse(message.response);}catch(e){return;}
self.setErrors(message,options);}}});}});ns.extend({'Dialog':Dialog,'styles':styles});});
/* Begin file: main.js */
namespace.lookup('com.pageforest.main').define(function(ns){var selectedTab;var fReadyCalled=false;function setTab(name){selectedTab=name||selectedTab;if(fReadyCalled&&selectedTab){$('#'+selectedTab+'-tab').addClass('selected');}}
function onReady(){fReadyCalled=true;$("input.focus:last").focus();setTab();}
ns.extend({'onReady':onReady,'setTab':setTab});});
/* Begin file: sign-up.js */
namespace.lookup('com.pageforest.auth.sign-up').define(function(exports){var require=namespace.lookup;var util=namespace.util;var cookies=require('org.startpad.cookies');var crypto=require('com.googlecode.crypto-js');var forms=require('com.pageforest.forms');var dialog=require('org.startpad.dialog');exports.extend({'onReady':onReady,'onSubmit':onSubmit,'resend':resend});var dlg;var keyTime;function validate(ignoreBlanks){dlg.clearErrors();var values=dlg.validate(ignoreBlanks);if(values.password!=values.repeat){dlg.isValid=false;if(!(ignoreBlanks&&values.repeat.length==0)){dlg.setErrors({repeat:"Passwords do not match"});}}
if(ignoreBlanks){dlg.postValues('/sign-up/',{ignoreBlanks:true,extra:{validate:true}});}}
function validateIfChanged(){var time=new Date().getTime();if(keyTime==undefined||time-keyTime<1000){return;}
if(!dlg.hasChanged(undefined,true)){return;}
validate(true);}
function onSubmit(){validate();if(dlg.isValid){dlg.postValues('/sign-up/',{onSucess:function(){window.location='/sign-in/';}});}}
function resend(){console.log("resend");$.ajax({type:"POST",url:"/email-verify/",data:{resend:true},dataType:"json",success:function(){$('span#result').css('color','#0A0').html("A new verification email was sent.");},error:function(){$('span#result').css('color','#F00').html("Sorry, please try again later.");}});return false;}
function onReady(){dlg=new dialog.Dialog({fields:[{name:'username',minSize:2,required:true},{name:'password',type:'password',minSize:6},{name:'repeat',type:'password',label:"Repeat password"},{name:'email',label:"Email address",required:true},{name:'tos',type:'checkbox',label:"Terms of Service",required:true},{name:'joinNow',label:"Join Now",type:'button',onClick:onSubmit}],style:dialog.styles.table});$('#sign-up-dialog').html(dlg.html());dlg.bindFields();setInterval(validateIfChanged,1000);$(dlg.dlg).keyup(function(){keyTime=new Date().getTime();});}});
/* Begin file: sign-in.js */
namespace.lookup('com.pageforest.auth.sign-in').define(function(exports){var require=namespace.lookup;var main=require('com.pageforest.main');var cookies=require('org.startpad.cookies');var crypto=require('com.googlecode.crypto-js');var dialog=require('org.startpad.dialog');var format=require('org.startpad.format');exports.extend({'onReady':onReady,'onSubmit':onSubmit,'transferSessionKey':transferSessionKey,'signOut':signOut,'closeForm':closeForm});var appId;var appAuthURL;var sessionKey;var dlg;function getAppDomain(appId){var parts=window.location.host.split('.');if(parts[0]=='www'){parts[0]=appId;}else{parts.splice(0,0,appId);}
return parts.join('.');}
function getJSONP(url,fn){$.ajax({type:"GET",url:url,dataType:"jsonp",success:fn,error:function(){fn({status:500});}});}
function closeForm(){$(document.body)[appId?'addClass':'removeClass']('app');setTimeout(window.close,2000);}
function getSessionKey(fn){fn=fn||function(){};if(!appId||sessionKey){fn();return;}
$.getJSON('/get-session-key/'+appId,function(json){if(json.status!=200){$('#error').text=json.statusText;return;}
$(document.body).addClass('session');sessionKey=json.sessionKey;fn();});}
function transferSessionKey(fn){fn=fn||function(){};if(!appAuthURL){fn();return;}
var url=appAuthURL+"set-session/"+sessionKey;getJSONP(url,function(message){if(typeof(message)!='string'){return;}
$(document.body).removeClass('session');if(fn){fn();}});return false;}
function onSuccess(message,status,xhr){$(document.body).addClass('user');$('.username').text(dlg.values.username);getSessionKey(function(){if(dlg.values.allowAccess){transferSessionKey(closeForm);return;}
var params=format.parseURLParams(window.location.href);if(params['continue']){window.location=params['continue'];return;}else{window.location.reload();}});}
function onError(xhr,status,message){var text=xhr.responseText;if(text.substr(0,19)=='Invalid signature: '){text=text.substr(19);}
if(/user/i.test(text)){dlg.setErrors({username:text});}else{dlg.setErrors({password:text});}}
function onChallenge(challenge,status,xhr){var userpass=crypto.HMAC(crypto.SHA1,dlg.values.username,dlg.values.password);var signature=crypto.HMAC(crypto.SHA1,challenge,userpass);var reply=dlg.values.username+'|'+challenge+'|'+signature;$.ajax({url:'/auth/verify/'+reply,success:onSuccess,error:onError});}
function onSubmit(){dlg.values=dlg.getValues();dlg.values.username=dlg.values.username.toLowerCase();$.ajax({url:'/auth/challenge',success:onChallenge,error:onError});return false;}
function onReady(forApp,verified){var username=cookies.getCookie('sessionuser');appId=forApp;dlg=new dialog.Dialog({fields:[{name:'username'},{name:'password',type:'password'},{name:'allowAccess',label:"Allow Access to "+appId,type:'checkbox'},{name:'signIn',label:"Sign In",type:'button',onClick:onSubmit}],style:dialog.styles.table});$('#sign-in-dialog').html(dlg.html());dlg.bindFields();if(appId){appAuthURL='http://'+getAppDomain(appId)+'/auth/';}else{dlg.showField('allowAccess',false);}
if(appId){$(document.body).addClass('app');}
if(username){$(document.body).addClass('user');$('.username').text(username);getSessionKey();}
if(verified){$(document.body).addClass('verified');}}
function signOut(){if(appId){sessionKey='expired';transferSessionKey(function(){window.location='/sign-out/'+appId;});return;}
window.location='/sign-out/';}});
/* Begin file: profile.js */
namespace.lookup('com.pageforest.auth.profile').define(function(ns){var cookies=namespace.lookup('org.startpad.cookies');var crypto=namespace.lookup('com.googlecode.crypto-js');var forms=namespace.lookup('com.pageforest.forms');function validatePassword(){var password=$("#id_password").val();var repeat=$("#id_repeat").val();if(!password.length){return{password:"This field is required."};}
if(password.length<6){return{password:"Ensure this value has at least 6 characters (it has "+
password.length+")."};}
if(password!=repeat){return{repeat:"Password and repeat are not the same."};}
return false;}
function onValidate(message,status,xhr,options){var passwordErrors=validatePassword();for(var error in passwordErrors){if(passwordErrors.hasOwnProperty(error)){message[error]=passwordErrors[error];}}
var fields=['username','password','repeat','email'];if(!options||!options.ignoreEmpty){fields.push('tos');}
forms.showValidatorResults(fields,message,options);}
function onValidateIgnoreEmpty(message,status,xhr){onValidate(message,status,xhr,{ignoreEmpty:true});}
function onSuccess(message,status,xhr){window.location='/sign-in/';}
function onError(xhr,status,message){console.error(xhr);}
function getFormData(){var username=$("#id_username").val();var lower=username.toLowerCase();var password=$("#id_password").val();return{username:username,password:crypto.HMAC(crypto.SHA1,lower,password),email:$("#id_email").val(),tos:$("#id_tos").attr('checked')?'checked':''};}
function isChanged(){var username=$("#id_username").val();var password=$("#id_password").val();var repeat=$("#id_repeat").val();var email=$("#id_email").val();var oneline=[username,password,repeat,email].join('|');if(oneline==ns.previous){return false;}
ns.previous=oneline;return true;}
function validateIfChanged(){if(!isChanged()){return;}
var data=getFormData();data.validate=true;forms.postFormData('/sign-up/',data,null,onValidateIgnoreEmpty,onError);}
function onSubmit(){var errors=validatePassword();if(errors){forms.showValidatorResults(['password','repeat'],errors);}else{forms.postFormData('/sign-up/',getFormData(),onSuccess,onValidate,onError);}
return false;}
function resend(){console.log("resend");$.ajax({type:"POST",url:"/email-verify/",data:{resend:true},dataType:"json",success:function(){$('span#result').css('color','#0A0').html("A new verification email was sent.");},error:function(){$('span#result').css('color','#F00').html("Sorry, please try again later.");}});return false;}
function onReady(){$('#enablejs').hide();$('input').removeAttr('disabled');if(cookies.getCookie('httponly')){$('#httponly').show();}
isChanged();setInterval(validateIfChanged,1000);$('#id_tos').click(function(){$('#validate_tos').html('');});}
ns.extend({onReady:onReady,onSubmit:onSubmit,resend:resend});});
