{% extends "page.html" %}

{% block title %}Sign In{% endblock %}

{% block extra-head %}
<style>
body.session .if_not_session, body:not(.session) .if_session { display: none; }
</style>
<script type="text/javascript">
var signIn = namespace.lookup("com.pageforest.auth.sign-in");
$(document).ready(function() {
    var username = "{{ user.username }}";
    var appId = "{{ cross_app.get_app_id }}";
    signIn.onReady(username, appId);
});
</script>
{% endblock %}

{% block both-columns %}

  <h2 class="if_user"><span class="username"></span>, you are signed in to {{ SITE_NAME }}
    <span style="display:none;" class="if_app">and {{ cross_app.title }} ({{ cross_app.get_app_id }})</span>
  </h2>
  <h2 class="if_not_user">Sign in to {{ SITE_NAME }}
    <span class="if_app"> and {{ cross_app.title }} ({{ cross_app.get_app_id }})</span>
  </h2>

  <div class="if_app">
    <p>The application, <b>{{ cross_app.title }} ({{ cross_app.get_app_id }})</b>,
      uses the {{ SITE_NAME }} web application service to store your data.
    </p>
    <p>
      If you would like to sign-in to <i>{{ cross_app.title }}</i>
      then {% if not user %}sign-in and {% endif %} <i>Allow Access</i>, below.
    </p>
    <p>
      By <i>Allowing Access</i>, you are permitting <i>{{ cross_app.title }}</i> to:
      <ul>
        <li>Access your {{ SITE_NAME }} user
          name{% if user %} (<i><span class="username"></span></i>){% endif %}.</li>
        <li>Create, modify, and read documents in your {{ SITE_NAME }} account on your behalf.</li>
        {% ifequal cross_app.get_app_id "editor" %}
        <li>Create, modify, and read other application files that you are developing with {{ SITE_NAME }}.</li>
        {% else %}
        <li><i>Note that {{ cross_app.title }} will <b>not</b> have access to non-public
            documents created by any other {{ SITE_NAME }} application.</i></li>
        {% endifequal %}
      </ul>
    </p>
    <input class="if_session" type="button" value="Allow Access"
           onclick="signIn.transferSessionKey(signIn.closeForm)" />
  </div>

    <p class="error"></p>

    <form id="sign-in" class="if_not_user" method="post" onsubmit="return signIn.onSubmit()">
      <table>
        <tr>
          <td><label for="id_username">Username</label>:</td>
          <td><input id="id_username" type="text" class="focus" name="username" maxlength="30" /></td>
          <td class="form-message" id="validate_username"><span class="error"></span></td>
        </tr>

        <tr>
          <td><label for="id_password">Password</label>:</td>
          <td><input id="id_password" type="password" name="password" maxlength="40" /></td>
          <td class="form-message" id="validate_password"><span class="error"></span> </td>
        </tr>

        <tr class="if_app">
          <td><label for="id_appauth">{{ cross_app.get_app_id }}</label>:</td>
          <td><input type="checkbox" name="appauth" id="id_appauth" />&nbsp;<label for="id_appauth">Allow access</label></td>
          <td></td>
        </tr>

        <tr><td></td>
          <td><input type="submit" value="Sign In"/></td>
          <td></td>
        </tr>

      </table>
    </form>

{% if user %}
    {% if not user.email_verified %}
        <p class="error">Check your email for an <a href="/email-verify">email verification</a> message.</p>
    {% endif %}
{% endif %}
  <p class="if_user"><a href="/sign-out/" onclick="signIn.signOut();return false;">Sign Out</a></p>
  <p class="if_not_user">Need to create account?  <a href="/sign-up">Join Now</a>.</p>

{% endblock both-columns %}
