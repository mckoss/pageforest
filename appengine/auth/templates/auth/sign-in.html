{% extends "page.html" %}

{% block title %}Sign In{% endblock %}

{% block extra-head %}
<script type="text/javascript">
$(document).ready(function() {
    var ns = global_namespace.lookup("com.pageforest.auth.sign-in-form");
    var username = "{{user.username}}";
    var appId = "{{cross_app.app_id}}";
    ns.documentReady(username, appId);
});
</script>
{% endblock %}

{% block both-columns %}

<h2>
{% if user %}
    {{ user.username }}, you are signed in to {{SITE_NAME}}
    <span style="display:none;" class="have_app">and {{ cross_app.title}}</span>.
{% else %}
    Sign in to {{SITE_NAME}}
    {% if cross_app %} and {{ cross_app.title }}{% endif %}.
{% endif %}
</h2>

{% if cross_app %}
    <p class="want_app">The application, <b>{{ cross_app.title }}</b>,
      is requesting permission to save documents on {{ SITE_NAME }}.
    </p>
{% endif %}

{% if form.non_field_errors %}
    <p class="error">{{ form.non_field_errors.0 }}</p>
{% endif %}

<form method="post">
    {{ csrf_token }}
    <table>
    {% for field in form %}
    {% if user %}
    {% else %}
    <tr>
      <td>{{ field.label_tag }}:</td>
      <td>{{ field }}</td>
      <td class="form-message" id="validate_{{ field.html_name }}">
         <span class="error">{{ field.errors.0 }}</span>
      </td>
    </tr>
    {% endif %}
    {% endfor %}
    {% if cross_app or not user %}
    <tr><td></td><td><input class="want_app" type="submit" value="Sign In" />
      </td><td></td></tr>
    {% endif %}
    </table>
</form>

{% if user %}
    <p><a href="/auth/sign-out">Sign Out</a></p>
{% else %}
    <p>Need to create account?  <a href="/auth/sign-up">Join Now</a>.</p>
{% endif %}

{% endblock both-columns %}
